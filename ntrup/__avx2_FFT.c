
#include <memory.h>

#include "__avx2_FFT.h"
#include "NTT_params.h"

int16_t const_twiddle51p[48] = {
    1262, -2247, 985, -1523, 780, 743, -734, -1276, 2010, -824, -832, 1656, 1089, 1055, -2144, 1185, -1255, 70, 1593, 405, -1998, -1264, -1722, -1605, -781, -432, 1213, 124, -1836, 1712, 527, 1379, -1906, 1092, 122, -1214, 50, -1777, 1727, -2083, 482, 1601, 1477, -247, -1230, -1757, 98, 1659
};
int16_t const_twiddle51n[48] = {
    -1262, 2247, -985, 1523, -780, -743, 734, 1276, -2010, 824, 832, -1656, -1089, -1055, 2144, -1185, 1255, -70, -1593, -405, 1998, 1264, 1722, 1605, 781, 432, -1213, -124, 1836, -1712, -527, -1379, 1906, -1092, -122, 1214, -50, 1777, -1727, 2083, -482, -1601, -1477, 247, 1230, 1757, -98, -1659
};
int16_t const_twiddle102_last[8] = {
    567, -567, -1879, 1879, 1312, -1312
};

int16_t const_twiddle17[17 * 16] = {
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495,
-2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280,
-998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998,
-2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288,
-2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286,
-1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440,
1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837,
-2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150,
-1045, -1045, -1045, -1045, -1045, -1045, -1045, -1045, -1045, -1045, -1045, -1045, -1045, -1045, -1045, -1045,
-2045, -2045, -2045, -2045, -2045, -2045, -2045, -2045, -2045, -2045, -2045, -2045, -2045, -2045, -2045, -2045,
-1784, -1784, -1784, -1784, -1784, -1784, -1784, -1784, -1784, -1784, -1784, -1784, -1784, -1784, -1784, -1784,
1728, 1728, 1728, 1728, 1728, 1728, 1728, 1728, 1728, 1728, 1728, 1728, 1728, 1728, 1728, 1728,
1586, 1586, 1586, 1586, 1586, 1586, 1586, 1586, 1586, 1586, 1586, 1586, 1586, 1586, 1586, 1586,
1400, 1400, 1400, 1400, 1400, 1400, 1400, 1400, 1400, 1400, 1400, 1400, 1400, 1400, 1400, 1400,
1843, 1843, 1843, 1843, 1843, 1843, 1843, 1843, 1843, 1843, 1843, 1843, 1843, 1843, 1843, 1843,
-1145, -1145, -1145, -1145, -1145, -1145, -1145, -1145, -1145, -1145, -1145, -1145, -1145, -1145, -1145, -1145
};

int16_t const_twiddle17pre[17 * 16] = {
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097,
12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904,
-2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170,
18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928,
-15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346,
-29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792,
9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379,
13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318,
-15931, -15931, -15931, -15931, -15931, -15931, -15931, -15931, -15931, -15931, -15931, -15931, -15931, -15931, -15931, -15931,
16173, 16173, 16173, 16173, 16173, 16173, 16173, 16173, 16173, 16173, 16173, 16173, 16173, 16173, 16173, 16173,
32632, 32632, 32632, 32632, 32632, 32632, 32632, 32632, 32632, 32632, 32632, 32632, 32632, 32632, 32632, 32632,
9536, 9536, 9536, 9536, 9536, 9536, 9536, 9536, 9536, 9536, 9536, 9536, 9536, 9536, 9536, 9536,
18158, 18158, 18158, 18158, 18158, 18158, 18158, 18158, 18158, 18158, 18158, 18158, 18158, 18158, 18158, 18158,
-5624, -5624, -5624, -5624, -5624, -5624, -5624, -5624, -5624, -5624, -5624, -5624, -5624, -5624, -5624, -5624,
-27907, -27907, -27907, -27907, -27907, -27907, -27907, -27907, -27907, -27907, -27907, -27907, -27907, -27907, -27907, -27907,
-6167, -6167, -6167, -6167, -6167, -6167, -6167, -6167, -6167, -6167, -6167, -6167, -6167, -6167, -6167, -6167
};

int16_t const_twiddle17inv[17 * 16] = {
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495, 495,
-2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280, -2280,
-998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998, -998,
-2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288, -2288,
-2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286, -2286,
-1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440, -1440,
1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837, 1837,
-2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150, -2150,
1045, 1045, 1045, 1045, 1045, 1045, 1045, 1045, 1045, 1045, 1045, 1045, 1045, 1045, 1045, 1045,
2045, 2045, 2045, 2045, 2045, 2045, 2045, 2045, 2045, 2045, 2045, 2045, 2045, 2045, 2045, 2045,
1784, 1784, 1784, 1784, 1784, 1784, 1784, 1784, 1784, 1784, 1784, 1784, 1784, 1784, 1784, 1784,
-1728, -1728, -1728, -1728, -1728, -1728, -1728, -1728, -1728, -1728, -1728, -1728, -1728, -1728, -1728, -1728,
-1586, -1586, -1586, -1586, -1586, -1586, -1586, -1586, -1586, -1586, -1586, -1586, -1586, -1586, -1586, -1586,
-1400, -1400, -1400, -1400, -1400, -1400, -1400, -1400, -1400, -1400, -1400, -1400, -1400, -1400, -1400, -1400,
-1843, -1843, -1843, -1843, -1843, -1843, -1843, -1843, -1843, -1843, -1843, -1843, -1843, -1843, -1843, -1843,
1145, 1145, 1145, 1145, 1145, 1145, 1145, 1145, 1145, 1145, 1145, 1145, 1145, 1145, 1145, 1145
};

int16_t const_twiddle17invpre[17 * 16] = {
0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097, 4097,
12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904, 12904,
-2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170, -2170,
18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928, 18928,
-15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346, -15346,
-29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792, -29792,
9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379, 9379,
13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318, 13318,
15931, 15931, 15931, 15931, 15931, 15931, 15931, 15931, 15931, 15931, 15931, 15931, 15931, 15931, 15931, 15931,
-16173, -16173, -16173, -16173, -16173, -16173, -16173, -16173, -16173, -16173, -16173, -16173, -16173, -16173, -16173, -16173,
-32632, -32632, -32632, -32632, -32632, -32632, -32632, -32632, -32632, -32632, -32632, -32632, -32632, -32632, -32632, -32632,
-9536, -9536, -9536, -9536, -9536, -9536, -9536, -9536, -9536, -9536, -9536, -9536, -9536, -9536, -9536, -9536,
-18158, -18158, -18158, -18158, -18158, -18158, -18158, -18158, -18158, -18158, -18158, -18158, -18158, -18158, -18158, -18158,
5624, 5624, 5624, 5624, 5624, 5624, 5624, 5624, 5624, 5624, 5624, 5624, 5624, 5624, 5624, 5624,
27907, 27907, 27907, 27907, 27907, 27907, 27907, 27907, 27907, 27907, 27907, 27907, 27907, 27907, 27907, 27907,
6167, 6167, 6167, 6167, 6167, 6167, 6167, 6167, 6167, 6167, 6167, 6167, 6167, 6167, 6167, 6167
};

uint64_t _tbl[17] = {0, 96, 192, 288, 384, 480, 576, 672, 768, 864, 960, 1056, 1152, 1248, 1344, 1440, 1536};
uint64_t permute_tbl[2 * 17 * 3] = {
0, 576, 1152, 1728, 2304, 2880, 192, 768, 1344, 1920, 2496, 3072, 384, 960, 1536, 2112, 2688, 1088, 1664, 2240, 2816, 128, 704, 1280, 1856, 2432, 3008, 320, 896, 1472, 2048, 2624, 3200, 512, 2176, 2752, 64, 640, 1216, 1792, 2368, 2944, 256, 832, 1408, 1984, 2560, 3136, 448, 1024, 1600, 1632, 2208, 2784, 96, 672, 1248, 1824, 2400, 2976, 288, 864, 1440, 2016, 2592, 3168, 480, 1056, 2720, 32, 608, 1184, 1760, 2336, 2912, 224, 800, 1376, 1952, 2528, 3104, 416, 992, 1568, 2144, 544, 1120, 1696, 2272, 2848, 160, 736, 1312, 1888, 2464, 3040, 352, 928, 1504, 2080, 2656, 3232
};

int16_t OMEGA3_buff[16] = {
    OMEGA3Rmod, OMEGA3Rmod, OMEGA3Rmod, OMEGA3Rmod,
    OMEGA3Rmod, OMEGA3Rmod, OMEGA3Rmod, OMEGA3Rmod,
    OMEGA3Rmod, OMEGA3Rmod, OMEGA3Rmod, OMEGA3Rmod,
    OMEGA3Rmod, OMEGA3Rmod, OMEGA3Rmod, OMEGA3Rmod
};

int16_t OMEGA3INV_buff[16] = {
    OMEGA3INVRmod, OMEGA3INVRmod, OMEGA3INVRmod, OMEGA3INVRmod,
    OMEGA3INVRmod, OMEGA3INVRmod, OMEGA3INVRmod, OMEGA3INVRmod,
    OMEGA3INVRmod, OMEGA3INVRmod, OMEGA3INVRmod, OMEGA3INVRmod,
    OMEGA3INVRmod, OMEGA3INVRmod, OMEGA3INVRmod, OMEGA3INVRmod
};

int16_t twiddle_CT[48] = {
1262, 985, 2247, 124, -1712, 1836, -1523, -743, -780, 527, 1906, 1379, -734, -2010, -1276, -1092, 1214, -122, 824, 1656, -832, 50, 1727, 1777, 1089, -2144, 1055, 2083, 1601, 482, 1185, 70, -1255, -1477, -1230, 247, 1593, 1998, 405, -1757, 1659, -98, -1264, 1605, 1722, -567, 1312, -1879
};

int16_t twiddle_GS[48] = {
1262, -2247, -985, -781, 432, -1213, 567, 1879, -1312, -1264, 1722, -1605, -1757, -98, 1659, -1593, -405, 1998, -1477, -247, -1230, 1185, -1255, -70, -2083, 482, 1601, -1089, 1055, -2144, 50, -1777, 1727, 824, -832, -1656, 1092, -122, -1214, -734, -1276, -2010, 527, -1379, 1906, 1523, 780, 743
};

void rader_17_Rmod_int16x16(int16_t *des, int16_t *src, int16_t *twiddle_table, int16_t *twiddle_inv_table, size_t jump){

    int16_t srcx16[17 * 16];
    int16_t buffx16[17 * 16];

    for(size_t i = 0; i < 17; i++){
        memmove(srcx16 + i * 16, src + i * jump, 16 * sizeof(int16_t));
    }

    __asm_rader17(buffx16, srcx16, twiddle_table, twiddle_inv_table, const_buff);

    for(size_t i = 0; i < 17; i++){
        memmove(des + i * jump, buffx16 + i * 16, 16 * sizeof(int16_t));
    }

}

void rader_17_scalei_Rmod_int16x16(int16_t *des, int16_t *src, int16_t *twiddle_table, int16_t *twiddle_inv_table){

    __asm_rader17_scalei(des, src, twiddle_table, twiddle_inv_table, const_buff);

}








